# Техническое задание: Образовательная платформа по изучению Python

## 1. Общее описание
Платформа представляет собой веб-приложение для изучения языка программирования Python. Система включает в себя систему уроков, тестирование, практические задания и систему управления пользователями.

## 2. Функциональные требования

### 2.1 Система уроков
- Уроки открываются последовательно
- Доступ к урокам:
  - Список всех уроков в личном кабинете
  - Визуальное разделение на три состояния:
    - Открытые для прохождения (ученик прошел все предыдущие уроки)
    - Открытые для ученика (ученик может их открыть, если пройдет предыдущие)
    - Закрытые (уроки не открываются, пока учитель их не разблокирует)
  - Закрытые уроки доступны только после:
    - Успешного прохождения предыдущих уроков
    - Явного открытия доступа учителем
  - Индикация прогресса по каждому уроку
  - Возможность вернуться к пройденным урокам
- Сохранение прогресса:
  - Автоматическое сохранение прогресса по теории
  - Сохранение результатов тестов
  - Сохранение решений практических задач
  - Сохранение комментариев учителя
  - История изменений решений
  - Восстановление сессии при перезагрузке страницы
  - Синхронизация прогресса между устройствами
- Навигация внутри урока:
  - Выбор между теоретической и практической частями
  - Практическая часть доступна только после успешного прохождения теоретической части
  - Индикация доступности частей урока
  - Возможность вернуться к пройденным частям
- Каждый урок состоит из:
  - Теоретической части:
    - Разделение на логические блоки/пункты
    - Навигация между блоками через табы или боковое меню
    - Индикатор прогресса прохождения теоретической части
    - Возможность вернуться к предыдущим блокам
    - Сохранение прогресса прочтения
  - Теста по теории:
    - Множественный выбор ответов
    - Установленный процент правильных ответов для прохождения
    - Ограничение времени на прохождение (опционально)
    - Возможность повторного прохождения после неудачи
    - Сохранение результатов всех попыток
    - Подробная статистика по ответам
  - Практической части:
    - Обязательные задачи:
      - Необходимы для прохождения урока
      - Должны быть решены для получения доступа к следующему уроку
      - Могут иметь разный уровень сложности
      - Для каждой задачи:
        - Подробное описание
        - Примеры входных и выходных данных
        - Автоматические тесты для проверки
    - Дополнительные задачи:
      - Не обязательны для прохождения урока
      - Предназначены для углубленного изучения темы
      - Могут быть более сложными
      - Для каждой задачи:
        - Подробное описание
        - Примеры входных и выходных данных
        - Автоматические тесты для проверки
        - Дополнительные подсказки (опционально)
    - Общие требования:
      - Возможность решать задачи в любом порядке
      - Сохранение решений между сессиями
      - Возможность просмотра и комментирования решений учителем
      - Индикация обязательных и дополнительных задач
      - Прогресс по обязательным задачам влияет на доступ к следующему уроку
- Прогресс прохождения уроков сохраняется
- Учитель может открывать доступ к урокам для класса
- Система рейтинга и статистики:
  - Общий рейтинг ученика:
    - Количество пройденных уроков
    - Количество решенных задач (обязательных и дополнительных)
    - Средний балл за тесты
    - Количество попыток на тест
    - Время прохождения уроков
    - Количество использованных подсказок
    - Количество исправлений в решениях
    - Рейтинг в классе
    - Рейтинг среди всех учеников
  - Детальная статистика:
    - Прогресс по каждому уроку
    - Время, затраченное на каждый урок
    - Количество попыток для каждой задачи
    - История изменений решений
    - Успешность тестов по темам
    - Графики прогресса
    - Сравнение с одноклассниками
- Встроенный редактор кода:
  - Поддержка синтаксиса Python
  - Подсветка синтаксиса
  - Автодополнение кода
  - Проверка синтаксиса в реальном времени
  - Форматирование кода
  - Интегрированный терминал для вывода
  - Возможность запуска кода
  - Отображение ошибок выполнения
  - Сохранение черновиков решений
  - История изменений кода
  - Возможность отката к предыдущим версиям
  - Интеграция с системой тестирования
  - Поддержка отладки:
    - Точки останова
    - Пошаговое выполнение
    - Просмотр переменных
    - Стек вызовов
  - Интерактивные подсказки:
    - Подсказки по синтаксису
    - Подсказки по стандартной библиотеке
    - Примеры использования функций
  - Интеграция с системой проверки:
    - Автоматическая проверка решений
    - Отображение результатов тестов
    - Подробный вывод ошибок

### 2.2 Система пользователей

#### 2.2.1 Супер-администратор
- Создание токенов для регистрации учителей
- Управление учителями (удаление)
- Просмотр всех классов
- Удаление участников из классов
- Создание и редактирование плана уроков
- Создание и редактирование уроков:
  - Теоретическая часть
  - Тесты:
    - Создание вопросов с множественным выбором
    - Установка правильных ответов
    - Настройка процента правильных ответов для прохождения
    - Установка временных ограничений
  - Практические задания

#### 2.2.2 Преподаватель
- Регистрация с использованием токена от админа
- Управление классами:
  - Создание классов
  - Генерация токенов для подключения учеников
  - Редактирование названия класса
  - Удаление учеников
- Управление доступом к урокам:
  - Открытие/закрытие доступа к урокам для класса
  - Настройка последовательности открытия уроков
  - Просмотр статуса доступа к урокам для каждого ученика
  - Массовое управление доступом к урокам
  - История изменений доступа к урокам
- Просмотр прогресса учеников
- Просмотр и комментирование решений учеников:
  - Просмотр кода решения
  - Добавление комментариев к коду
  - Просмотр истории изменений решения
  - Возможность оценить решение
- Общение с классом:
  - Общий чат
  - Личные сообщения
  - Удаление сообщений в общем чате

#### 2.2.3 Ученик
- Регистрация в системе
- Подключение к классу через токен
- Личный кабинет:
  - Список всех уроков с индикацией доступности
  - Прогресс прохождения каждого урока
  - Статистика успеваемости
  - История решений задач
  - Система общения:
    - Общий чат класса:
      - Отправка сообщений
      - Просмотр истории сообщений
      - Уведомления о новых сообщениях
      - Возможность прикрепления файлов
    - Личные сообщения с учителем:
      - Создание нового диалога
      - Просмотр истории сообщений
      - Уведомления о новых сообщениях
      - Возможность прикрепления файлов
      - Индикация прочтения сообщений
- Прохождение уроков:
  - Изучение теории
  - Прохождение тестов
  - Выполнение практических заданий

## 3. Технические требования

### 3.1 Бэкенд
- Python 3.8+
- Flask 2.0+
- Flask-SQLAlchemy (для работы с базой данных)
- Flask-Migrate (для миграций базы данных)
- Flask-Login (для аутентификации)
- Flask-WTF (для форм)
- Flask-SocketIO (для чата)
- Flask-RESTful (для API)
- PostgreSQL (основная база данных)
- Redis (для кэширования и очередей)
- Celery (для асинхронных задач)

### 3.2 Фронтенд
- HTML5, CSS3
- JavaScript (Vanilla JS + jQuery)
- Bootstrap 5 (для стилизации)
- CodeMirror (для редактора кода)
- Socket.IO (для чата)
- AJAX (для асинхронных запросов)

### 3.3 Безопасность
- Flask-Login для аутентификации
- Flask-WTF CSRF защита
- Flask-Security для ролевой модели
- Валидация форм через WTForms
- Защита от XSS и SQL-инъекций
- HTTPS
- Безопасное хранение паролей (bcrypt)

### 3.4 Структура проекта
```
project/
├── app/
│   ├── __init__.py
│   ├── models/
│   │   ├── __init__.py
│   │   ├── user.py
│   │   ├── class.py
│   │   ├── lesson.py
│   │   └── message.py
│   ├── routes/
│   │   ├── __init__.py
│   │   ├── auth.py
│   │   ├── admin.py
│   │   ├── teacher.py
│   │   ├── student.py
│   │   └── api.py
│   ├── static/
│   │   ├── css/
│   │   ├── js/
│   │   └── images/
│   ├── templates/
│   │   ├── base.html
│   │   ├── auth/
│   │   ├── admin/
│   │   ├── teacher/
│   │   └── student/
│   └── utils/
│       ├── __init__.py
│       ├── decorators.py
│       └── helpers.py
├── migrations/
├── tests/
├── config.py
├── requirements.txt
└── run.py
```

### 3.5 Основные Flask-расширения
- Flask-SQLAlchemy: ORM для работы с базой данных
- Flask-Migrate: Управление миграциями базы данных
- Flask-Login: Управление аутентификацией
- Flask-WTF: Работа с формами и CSRF защита
- Flask-Security: Ролевая модель и безопасность
- Flask-SocketIO: Реализация чата
- Flask-RESTful: REST API
- Flask-Mail: Отправка email
- Flask-Caching: Кэширование
- Flask-Celery: Асинхронные задачи

### 3.6 Конфигурация
- Разделение конфигурации на development, testing и production
- Использование переменных окружения для секретных данных
- Конфигурация через классы в config.py
- Поддержка .env файлов

### 3.7 Тестирование
- pytest для unit и integration тестов
- Flask-Testing для тестирования Flask-приложения
- Factory Boy для создания тестовых данных
- Coverage для измерения покрытия кода тестами

### 3.8 Развертывание
- Gunicorn как WSGI сервер
- Nginx как reverse proxy
- Supervisor для управления процессами
- Docker для контейнеризации
- GitHub Actions для CI/CD

## 4. Структура базы данных

### 4.1 Основные таблицы
- Users (пользователи)
  - Поле rating (общий рейтинг)
  - Поле lessons_completed (количество пройденных уроков)
  - Поле tasks_solved (количество решенных задач)
  - Поле average_test_score (средний балл за тесты)
  - Поле total_time_spent (общее время обучения)
- Classes (классы)
- Lessons (уроки)
- LessonAccess (доступ к урокам)
  - Поле is_available (доступен для прохождения)
  - Поле is_unlocked (разблокирован учителем)
  - Поле unlock_date (дата разблокировки)
  - Поле unlocked_by (кем разблокирован)
- LessonAccessHistory (история изменений доступа)
  - Поле action (открытие/закрытие)
  - Поле action_date
  - Поле action_by
- TheoryContent (теоретический материал)
- TheoryProgress (прогресс по теории)
- Tests (тесты)
- TestQuestions (вопросы теста)
- TestAnswers (варианты ответов)
- TestResults (результаты тестов)
- TestAttempts (попытки прохождения теста)
- Tasks (практические задания)
  - Поле is_required (обязательная/дополнительная)
  - Поле difficulty_level (уровень сложности)
  - Поле hints (подсказки)
- TaskSolutions (решения задач)
- SolutionHistory (история изменений решений)
- SolutionComments (комментарии к решениям)
- Messages (сообщения)
  - Поле message_type (общее/личное)
  - Поле is_read (прочитано/не прочитано)
  - Поле attachments (прикрепленные файлы)
- MessageAttachments (прикрепленные файлы)
- Progress (общий прогресс учеников)
- TeacherTokens (токены для учителей)
- StudentTokens (токены для учеников)
- UserSessions (сессии пользователей)
- UserStatistics (статистика пользователя)
  - Поле user_id
  - Поле lesson_id
  - Поле completion_time (время прохождения)
  - Поле attempts_count (количество попыток)
  - Поле hints_used (количество использованных подсказок)
  - Поле solution_revisions (количество исправлений)
  - Поле test_score (балл за тест)
  - Поле task_success_rate (процент успешных решений)
  - Поле time_spent (время, затраченное на урок)
- ClassRankings (рейтинги в классе)
  - Поле class_id
  - Поле user_id
  - Поле position (позиция в рейтинге)
  - Поле points (количество очков)
  - Поле last_update (последнее обновление)
- GlobalRankings (глобальные рейтинги)
  - Поле user_id
  - Поле position
  - Поле points
  - Поле last_update
- CodeSolutions (решения задач)
  - Поле user_id
  - Поле task_id
  - Поле code (текст решения)
  - Поле status (статус проверки)
  - Поле execution_time (время выполнения)
  - Поле memory_usage (использование памяти)
  - Поле test_results (результаты тестов)
  - Поле error_message (сообщения об ошибках)
  - Поле created_at
  - Поле updated_at
- CodeHistory (история изменений кода)
  - Поле solution_id
  - Поле code_version
  - Поле code_snapshot
  - Поле changes (изменения)
  - Поле created_at
  - Поле user_id

## 5. API Endpoints

### 5.1 Аутентификация
- POST /api/auth/register
- POST /api/auth/login
- POST /api/auth/refresh

### 5.2 Управление пользователями
- GET /api/users/profile
- PUT /api/users/profile
- GET /api/users/classes
- POST /api/users/join-class
- GET /api/users/lessons (список уроков с состоянием доступа)
- GET /api/users/progress (общий прогресс)
- GET /api/users/statistics (детальная статистика)
- GET /api/users/rating (рейтинг пользователя)
- GET /api/users/class-ranking (рейтинг в классе)
- GET /api/users/global-ranking (глобальный рейтинг)
- GET /api/users/achievements (достижения)
- GET /api/users/{id}/theory-progress (прогресс по теории)
- GET /api/users/{id}/test-results (результаты тестов)
- GET /api/users/{id}/task-solutions (решения задач)
- GET /api/users/{id}/solution-history (история изменений решений)
- POST /api/users/save-progress (сохранение прогресса)
- GET /api/users/restore-session (восстановление сессии)

### 5.3 Управление классами
- POST /api/classes
- GET /api/classes
- PUT /api/classes/{id}
- DELETE /api/classes/{id}
- POST /api/classes/{id}/students
- DELETE /api/classes/{id}/students/{studentId}

### 5.4 Управление уроками
- GET /api/lessons
- POST /api/lessons
- PUT /api/lessons/{id}
- GET /api/lessons/{id}/content
- POST /api/lessons/{id}/progress
- GET /api/lessons/{id}/parts
- GET /api/lessons/{id}/theory
- GET /api/lessons/{id}/practice
- GET /api/lessons/{id}/tasks
- GET /api/lessons/{id}/access (получение статуса доступа)
- PUT /api/lessons/{id}/access (изменение статуса доступа)
- GET /api/lessons/{id}/access-history (история изменений доступа)
- POST /api/lessons/bulk-access (массовое управление доступом)
  - Фильтрация по обязательным/дополнительным
  - Сортировка по сложности
- GET /api/tasks/{id}
- POST /api/tasks/{id}/solution
- GET /api/tasks/{id}/solution
- GET /api/tasks/{id}/solutions (для учителя)
- POST /api/solutions/{id}/comment
- GET /api/solutions/{id}/comments
- GET /api/tasks/{id}/hints (для дополнительных задач)
- POST /api/lessons/{id}/run-code (запуск кода)
- POST /api/lessons/{id}/check-solution (проверка решения)
- GET /api/lessons/{id}/code-history (история изменений кода)
- POST /api/lessons/{id}/save-draft (сохранение черновика)

### 5.5 Чат
- GET /api/chat/messages (получение сообщений)
  - Фильтрация по типу (общий/личный)
  - Пагинация
  - Сортировка по времени
- POST /api/chat/messages (отправка сообщения)
  - Поддержка текста и файлов
  - Уведомления получателям
- DELETE /api/chat/messages/{id} (удаление сообщения)
- GET /api/chat/online (список пользователей онлайн)
- GET /api/chat/typing (индикатор набора текста)
- POST /api/chat/read (отметка о прочтении)
- GET /api/chat/attachments (получение прикрепленных файлов)
- POST /api/chat/attachments (загрузка файлов)

## 6. Интерфейс

### 6.1 Общие требования
- Адаптивный дизайн
- Поддержка мобильных устройств
- Интуитивно понятный интерфейс
- Доступность (WCAG 2.1)

### 6.2 Основные страницы
- Главная страница
- Личный кабинет:
  - Список уроков:
    - Визуальное разделение на открытые/закрытые
    - Индикатор прогресса по каждому уроку
    - Кнопка перехода к доступному уроку
    - Информация о требованиях для открытия закрытых уроков
  - Статистика успеваемости:
    - Общий рейтинг
    - Прогресс по урокам
    - Графики успеваемости
    - Сравнение с одноклассниками
    - Достижения
    - История активности
  - Детальная статистика:
    - Время обучения
    - Количество решенных задач
    - Успешность тестов
    - Использование подсказок
    - Количество исправлений
    - Рейтинг в классе
    - Глобальный рейтинг
  - История решений
  - Система общения:
    - Общий чат класса:
      - Список участников онлайн
      - История сообщений с прокруткой
      - Форма отправки сообщений
      - Индикатор набора текста
      - Уведомления о новых сообщениях
    - Личные сообщения:
      - Список диалогов
      - История сообщений в диалоге
      - Форма отправки сообщений
      - Индикатор прочтения
      - Уведомления о новых сообщениях
  - Встроенный редактор кода:
    - Основная область редактирования
    - Панель инструментов:
      - Кнопки форматирования
      - Кнопки запуска/остановки
      - Кнопки отладки
      - Кнопки сохранения
    - Терминал вывода
    - Панель отладки:
      - Стек вызовов
      - Значения переменных
      - Точки останова
    - Панель тестов:
      - Список тестов
      - Результаты выполнения
      - Подробные ошибки
    - Панель истории:
      - Список версий
      - Сравнение версий
      - Восстановление версий
- Страница урока:
  - Навигация между частями урока:
    - Кнопки выбора теоретической/практической части
    - Индикация доступности частей
    - Информация о требованиях для доступа к практической части
  - Теоретическая часть:
    - Боковая навигация с пунктами теории
    - Основная область для контента
    - Индикатор прогресса
    - Кнопки навигации между блоками
    - Возможность развернуть/свернуть навигацию
  - Практическая часть
  - Редактор кода
- Чат
- Административная панель

### 6.3 Интерфейс теоретической части
- Навигация:
  - Боковое меню с пунктами теории
  - Возможность сворачивания меню
  - Индикатор текущего пункта
  - Кнопки "Назад"/"Вперед" для навигации
- Отображение контента:
  - Адаптивная верстка для разных устройств
  - Поддержка форматирования текста (заголовки, списки, код)
  - Вставка изображений и видео
  - Подсветка синтаксиса для примеров кода
  - Интерактивные элементы (если необходимо)
- Прогресс:
  - Индикатор прохождения теории
  - Отметки о прочитанных пунктах
  - Возможность вернуться к любому пункту
- Дополнительные функции:
  - Поиск по теоретическому материалу
  - Добавление закладок
  - Возможность делать заметки
  - Экспорт теоретического материала

## 7. Тестирование
- Unit тесты
- Integration тесты
- Тесты безопасности
- Нагрузочное тестирование

## 8. Развертывание
- Docker контейнеры
- CI/CD пайплайн
- Мониторинг и логирование
- Резервное копирование

## 9. Документация
- API документация
- Руководство пользователя
- Руководство администратора
- Техническая документация 